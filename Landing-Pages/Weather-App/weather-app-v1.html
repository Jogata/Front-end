<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="weather-app">
        <div class="container">
            <a class="brand">w</a>
            <div>
                <h1 class="temp">16&#176;</h1>
                <div class="city-time">
                    <h1 class="name">London</h1>
                    <small>
                        <span class="time">06:09</span>
                        -
                        <span class="date">Monday Sep 19</span>
                    </small>
                </div>
                <div class="weather">
                    <i class="icon">
                        <img src="">
                    </i>
                    <span class="condition">Cloudy</span>
                </div>
            </div>
        </div>
        <div class="panel">
            <form action="" id="locationInput">
                <input type="text" name="s" id="s" class="search" placeholder="Search Location...">
                <button type="submit">
                    <i class="fa fa-search"></i>
                </button>
            </form>
            <ul class="cities">
                <li class="city">New York</li>
                <li class="city">California</li>
                <li class="city">Paris</li>
                <li class="city">Tokyo</li>
            </ul>
            <ul class="details">
                <h4>Weather Details</h4>
                <li>
                    <span>Cloudy</span>
                    <span class="cloud">89%</span>
                </li>
                <li>
                    <span>Humidity</span>
                    <span class="humidity">64%</span>
                </li>
                <li>
                    <span>Wind</span>
                    <span class="wind">8km/h</span>
                </li>
            </ul>
        </div>
    </div>

    <footer>
        <h1>https://www.weatherapi.com/</h1>
    </footer>

    <script>
        const app = document.querySelector(".weather-app");
        const temp = document.querySelector(".temp");
        const dateOutput = document.querySelector(".date");
        const timeOutput = document.querySelector(".time");
        const condition = document.querySelector(".condition");
        const name = document.querySelector(".name");
        const icon = document.querySelector(".icon img");
        const cloud = document.querySelector(".cloud");
        const humidity = document.querySelector(".humidity");
        const wind = document.querySelector(".wind");
        const form = document.querySelector("#locationInput");
        const search = document.querySelector(".search");
        const btn = document.querySelector("#locationInput button");
        const cities = document.querySelectorAll(".city");

        // Default city on page load
        let cityInput = "London";

        cities.forEach(city => {
            city.addEventListener("click", (e) => {
                cityInput = e.target.innerHTML;
                // Fetch the data from the Weather API
                fetchWeatherData();
                // Hide the content
                app.style.opacity = "0";
            })
        })

        form.addEventListener("submit", (e) => {
            if (search.value.length === 0) {
                alert("Please, type in a city name");
            } else {
                cityInput = search.value;
                fetchWeatherData();
                search.value = "";
                app.style.opacity = "0";
            }
            e.preventDefault();
        })

        function getDayOfTheWeek(day, month, year) {
            const weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            return weekdays[new Date(`${month}/${day}/${year}`).getDay()];
        }

        function fetchWeatherData() {
            // KEY: 19e7f8df964b4bb3b57142431232904
            fetch(`http://api.weatherapi.com/v1/current.json?key=19e7f8df964b4bb3b57142431232904&q=${cityInput}`)
            .then(data => data.json())
            .then(data => {
                temp.innerHTML = data.current.temp_c + "&#176;";
                condition.innerHTML = data.current.condition.text;

                const date = data.location.localtime;
                const y = parseInt(date.substr(0, 4));
                const m = parseInt(date.substr(5, 2));
                const d = parseInt(date.substr(8, 2));
                const time = date.substr(11);
                // Create a new date format: 17:53 - Friday 9, 10 2023
                dateOutput.innerHTML = `${getDayOfTheWeek(d, m, y)} ${d}, ${m} ${y}`;
                timeOutput.innerHTML = time;
                name.innerHTML = data.location.name;
                const iconImgURL = data.current.condition.icon;
                icon.src = `http://${iconImgURL}`;
                console.log(y);
                console.log(m);
                console.log(d);
                // Add weather details
                cloud.innerHTML = data.current.cloud + "%";
                humidity.innerHTML = data.current.humidity + "%";
                wind.innerHTML = data.current.wind_kph + "km/h";
                
                let timeOfDay = "day";

                const code = data.current.condition.code;

                if (!data.current.is_day) {
                    timeOfDay = "night";
                }
                
                if (code == 1000) {
                    app.style.backgroundImage = `url("./assets/img/weather-app/test/beach.jpg")`;
                    btn.style.background = "#e5ba92";
                    if (timeOfDay == "night") {
                        btn.style.background = "#181e27";
                    }
                } else if (
                    code == 1003 || 
                    code == 1006 || 
                    code == 1009 || 
                    code == 1030 || 
                    code == 1069 || 
                    code == 1087 || 
                    code == 1135 || 
                    code == 1273 || 
                    code == 1276 || 
                    code == 1279 || 
                    code == 1282
                ) {
                    app.style.backgroundImage = `url("./assets/img/weather-app/test/cloudy.jpg")`;
                    btn.style.background = "#fa6db1";
                    if (timeOfDay == "night") {
                        btn.style.background = "#181e27";
                    }
                } else if (
                    code == 1063 || 
                    code == 1069 || 
                    code == 1072 || 
                    code == 1150 || 
                    code == 1153 || 
                    code == 1180 || 
                    code == 1183 || 
                    code == 1186 || 
                    code == 1189 || 
                    code == 1192 || 
                    code == 1195 || 
                    code == 1204 || 
                    code == 1207 || 
                    code == 1240 || 
                    code == 1243 || 
                    code == 1246 || 
                    code == 1249 || 
                    code == 1252
                ) {
                    app.style.backgroundImage = `url("./assets/img/weather-app/test/rainy.jpg")`;
                    btn.style.background = "#647d75";
                    if (timeOfDay == "night") {
                        btn.style.background = "#325c80";
                    }
                } else {
                    app.style.backgroundImage = `url("./assets/img/weather-app/test/snowy.jpg")`;
                    btn.style.background = "#4d72aa";
                    if (timeOfDay == "night") {
                        btn.style.background = "#1b1b1b";
                    }
                }

                app.style.opacity = "1";
            })
            .catch(() => {
                alert("City not found, please try again");
                app.style.opacity = "1";
            })
            // .then(data => console.log(data.current.condition.icon));
        }

        fetchWeatherData();
    </script>
</body>
</html>