<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webstore v.1</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="./css/styles_webstore-v1.css">
  <style>
    body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto repeat(3, auto);
      text-align: center;
      min-height: 100vh;
      background-color: #aaa;
    }
    hr {
      grid-column: 1 / -1;
      height: min-content;
    }
    h1 {
      grid-column: 1 / -1;
      margin: auto;
      font-size: 6vw;
    }
    h2 {
      font-size: 4vw;
      text-transform: capitalize;
    }
    p {
      padding: 1em;
      font-size: 2vw;
    }
    button {
      padding: 0.6em 1.2em;
      font-size: 1.6vw;
      text-transform: capitalize;
      border: none;
      border-radius: 0.6em;
      background-color: transparent;
      box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.8), 
      -2px -2px 2px rgba(255, 255, 255, 0.2);
    }
    button:active {
      box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8), 
      -1px -1px 1px rgba(255, 255, 255, 0.2);
    }
    .site {
      margin: auto;
      padding: 1em;
      border: 1px solid #000;
      border-radius: 1em;
    }
  </style>
</head>
<body>
  <h1>Async/Await - Jokes</h1>
  <hr>
  <div class="site">
    <h2>Users</h2>
    <p>https://jsonplaceholder.typicode.com/users</p>
    <button type="button">get user data</button>
  </div>
  <div class="site">
    <h2>Dad's jokes</h2>
    <p>https://icanhazdadjoke.com</p>
    <button type="button">get a joke</button>
  </div>
  <div class="site">
    <h2>POST data</h2>
    <p>https://httpbin.org/post</p>
    <button type="button">post a joke</button>
  </div>
  <div class="site">
    <h2>Celebrities jokes</h2>
    <p>https://jsonplaceholder.typicode.com/users</p>
    <button type="button">get a joke</button>
  </div>

  <script>
    const users = {
      usersList: [],
    }

    const getUsersData = async () => {
      const response = await fetch("https://jsonplaceholder.typicode.com/users");
      const jsonUsersData = await response.json();
      users.usersList = jsonUsersData;
    }

    const displayUsersData = async () => {
      await getUsersData();
      const firstUser = users.usersList[0];
      console.log(`ID: ${firstUser.id}`);
      console.log(`Name: ${firstUser.name}`);
      console.log(`Username: ${firstUser.username}`);
      console.log("Address:");
      console.log(`- ${firstUser.address.city}`);
      console.log(`- "${firstUser.address.street}"`);
      console.log(`- "${firstUser.address.suite}"`);
      console.log(`- ${firstUser.address.zipcode}`);
      console.log(`- ${firstUser.address.geo.lat}`);
      console.log(`- ${firstUser.address.geo.lng}`);
      console.log(`Phone: ${firstUser.phone}`);
      console.log(`Email: ${firstUser.email}`);
      console.log(`Website: ${firstUser.website}`);
      console.log("Company:");
      console.log(`- "${firstUser.company.name}"`);
      console.log(`- ${firstUser.company.catchPhrase}`);
      console.log(`- ${firstUser.company.bs}`);
    }

    const getDadJoke = async () => {
      const joke = await fetch("https://icanhazdadjoke.com", {
        method: "GET",
        headers: {
          // Accept: "text/plain",
          Accept: "application/json",
        },
      });
      // For "text/plain" header
      // const jokeText = await joke.text();
      // console.log(jokeText);
      // For "application/json" header
      const jokeJSON = await joke.json();
      console.log(jokeJSON);
    }

    const joke = {
      id: "L6UnyP7Unyd",
      joke: "Doctor, I've broken my arm in several places. Doctor: Well don't go to those places.",
    }

    const postData = async (joke) => {
      const response = await fetch("https://httpbin.org/post", {
        method: "POST",
        headers: {
          "Content-type": "application/json",
        },
        body: JSON.stringify(joke),
      });

      const responseJSON = await response.json();
      console.log(responseJSON);
    }

    const getCelebrityJoke = async (firstName, lastName) => {
      const response = await fetch(`https://api.icndb.com/jokes/random?firstName=${firstName}&lastName=${lastName}&limitTo=[nerdy]`);
      const responseJSON = await response.json();
      console.log(responseJSON.value);
    }

    const buttons = document.getElementsByTagName("button");
    buttons[0].addEventListener("click", displayUsersData);
    buttons[1].addEventListener("click", getDadJoke);
    buttons[2].addEventListener("click", () => postData(joke));
    buttons[3].addEventListener("click", () => getCelebrityJoke("An", "Sw"));

    const getDataFromForm = () => {
      const requestObj = {
        firstName: "Bruce",
        lastName: "Lee",
        categories: ["nerdy"],
      }
      return requestObj;
    }

    const buildRequestURL = (requestData) => {
      return `https://api.icndb.com/jokes/random?firstName=${requestData.firstName}&lastName=${requestData.lastName}&limitTo=${requestData.categories}`;
    }

    const postJoke = (joke) => {
      console.log(joke);
    }

    const requestJoke = async (url) => {
      const response = await fetch(url);
      const responseJSON = await response.json();
      postJoke(responseJSON);
    }

    const processJokeRequest = async () => {
      const requestData = getDataFromForm();
      const requestUrl = buildRequestURL(requestData);
      await requestJoke(requestUrl);
      console.log("Finished!");
    }

    processJokeRequest();

    // Builder Pattern
    function Person(name, height, weight, gender) {
      this.name = name;
      this.height = height;
      this.weight = weight;
      this.gender = gender;
    }

    function PersonBuilder(name, gender) {
      this.name = name;
      this.gender = gender;

      this.setHeight = function (height) {
        this.height = height;
        return this;
      }

      this.setWeight = function (weight) {
        this.weight = weight;
        return this;
      }

      this.build = function () {
        return new Person(this.name, this.height, this.weight, this.gender);
      }
    }

    const jogata = new PersonBuilder("Jogata", "male").setHeight(1.75).setWeight(60).build();
    console.log(jogata);
  </script>
</body>
</html>